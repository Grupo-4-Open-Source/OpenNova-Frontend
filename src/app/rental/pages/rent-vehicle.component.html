<div class="rent-container">
  <h2>Rent Vehicle</h2>

  <div *ngIf="isLoading" class="loading-message">
    <mat-spinner></mat-spinner>
    <p>Cargando detalles de la publicaci√≥n...</p>
  </div>

  <div *ngIf="errorMessage && !isLoading" class="message error-message">
    <p>{{ errorMessage }}</p>
  </div>
  <div *ngIf="successMessage && !isLoading" class="message success-message">
    <p>{{ successMessage }}</p>
  </div>

  <div *ngIf="publication && vehicleDetails && pickupLocationDetails && !isLoading" class="publicacion-details">
    <h3>Listing Details</h3>
    <div class="card-content">
      <img [src]="vehicleDetails.mainImageUrl || 'https://placehold.co/400x300/CCCCCC/000000?text=No+Image'" alt="Vehicle image">
      <h4>{{ vehicleDetails.make }} {{ vehicleDetails.model }} ({{ vehicleDetails.year }})</h4>
      <p><strong>Daily Price:</strong> ${{ publication.dailyPrice | number:'1.2-2' }}</p>
      <p><strong>Location:</strong> {{ pickupLocationDetails.city }}, {{ pickupLocationDetails.addressLine1 }}</p>
      <p><strong>Rules:</strong> {{ publication.carRules }}</p>
      </div>
  </div>

  <form [formGroup]="rentForm" (ngSubmit)="onSubmit()" class="rent-form"
        *ngIf="publication && vehicleDetails && pickupLocationDetails && !isLoading">
    <h3>Select Your Rental Dates</h3>

    <div class="form-group">
      <label for="startDate">Start Date:</label>
      <input id="startDate" type="date" formControlName="startDate" [min]="todayDate">
      <div *ngIf="rentForm.get('startDate')?.invalid && (rentForm.get('startDate')?.dirty || rentForm.get('startDate')?.touched)" class="validation-error">
        <span *ngIf="rentForm.get('startDate')?.errors?.['required']">Start date is required.</span>
        <span *ngIf="rentForm.get('startDate')?.errors?.['startDatePast']">Start date cannot be in the past.</span>
        <span *ngIf="rentForm.get('startDate')?.errors?.['rentalDaysTooShort']">Minimum {{ rentForm.get('startDate')?.errors?.['rentalDaysTooShort']?.min }} days required.</span>
        <span *ngIf="rentForm.get('startDate')?.errors?.['rentalDaysTooLong']">Maximum {{ rentForm.get('startDate')?.errors?.['rentalDaysTooLong']?.max }} days allowed.</span>
      </div>
    </div>

    <div class="form-group">
      <label for="endDate">End Date:</label>
      <input id="endDate" type="date" formControlName="endDate" [min]="rentForm.get('startDate')?.value || todayDate">
      <div *ngIf="rentForm.get('endDate')?.invalid && (rentForm.get('endDate')?.dirty || rentForm.get('endDate')?.touched)" class="validation-error">
        <span *ngIf="rentForm.get('endDate')?.errors?.['required']">End date is required.</span>
        <span *ngIf="rentForm.get('endDate')?.errors?.['endDateBeforeStart']">End date cannot be before start date.</span>
        <span *ngIf="rentForm.get('endDate')?.errors?.['rentalDaysTooShort']">Minimum {{ rentForm.get('endDate')?.errors?.['rentalDaysTooShort']?.min }} days required.</span>
        <span *ngIf="rentForm.get('endDate')?.errors?.['rentalDaysTooLong']">Maximum {{ rentForm.get('endDate')?.errors?.['rentalDaysTooLong']?.max }} days allowed.</span>
      </div>
    </div>

    <div class="total-cost">
      <strong>Estimated Total Cost:</strong> ${{ totalCost | number:'1.2-2' }}
    </div>

    <button mat-raised-button color="primary" type="submit" [disabled]="rentForm.invalid || isLoading || totalCost <= 0">
      <span *ngIf="!isLoading">Confirm Rental</span>
      <span *ngIf="isLoading">Processing...</span>
    </button>
  </form>
</div>
